<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Rental Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .poster-item img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 5px;
    }
    .poster-item {
      margin-bottom: 20px;
    }
    .genre-card {
      color: white;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    #rentalRecordsTable td, #rentalRecordsTable th {
      vertical-align: middle;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">Movie Rental Dashboard</h1>

    <!-- Genre Cards -->
    <div class="row mb-4 g-3 text-white">
      <div class="col-md-2 genre-card" style="background-color:#dc3545;">Action</div>
      <div class="col-md-2 genre-card" style="background-color:#fd7e14;">Adventure</div>
      <div class="col-md-2 genre-card" style="background-color:#ffc107; color:#212529;">Comedy</div>
      <div class="col-md-2 genre-card" style="background-color:#20c997;">Romance</div>
      <div class="col-md-2 genre-card" style="background-color:#0d6efd;">Horror</div>
      <div class="col-md-2 genre-card" style="background-color:#6f42c1;">Animation</div>
    </div>

    <!-- Movie Posters Grid -->
    <div class="row" id="movie-posters"></div>

    <!-- Table & Doughnut Chart Section -->
    <div class="row mt-5">
      <div class="col-md-8">
        <table class="table table-bordered text-center align-middle">
          <thead class="table-dark">
            <tr><th>Genre</th><th>Total</th><th>Action</th></tr>
          </thead>
          <tbody id="genre-table"></tbody>
        </table>
      </div>
      <div class="col-md-4">
        <canvas id="genreChart"></canvas>
      </div>
    </div>

    <!-- Rental Price Section -->
    <div class="mt-5">
      <h4>Calculate Rental Cost</h4>
      <input type="text" id="username" placeholder="Enter your name" class="form-control mb-2" />
      <input type="number" id="rentedMovies" placeholder="Movies rented today" class="form-control mb-2" />
      <input type="number" id="pricePerMovie" placeholder="Price per movie" value="5" class="form-control mb-2" />
      <button class="btn btn-primary" onclick="calculatePrice()">Calculate</button>
      <p id="result" class="mt-3 fw-bold"></p>
    </div>

    <!-- Saved Rental Records Section -->
    <div class="mt-4">
      <h5>Saved Rental Records</h5>
      <table class="table table-striped" id="rentalRecordsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Movies Rented</th>
            <th>Price per Movie</th>
            <th>Total Price</th>
          </tr>
        </thead>
        <tbody id="rental-records-body"></tbody>
      </table>
      <button class="btn btn-danger" onclick="clearRentalRecords()">Clear All Records</button>
    </div>
  </div>

  <script>
    const apiKey = 'YOUR_TMDB_API_KEY'; // Replace with your TMDB API key
    const posterGrid = document.getElementById('movie-posters');

    // 3. Updated fallback posters replacing requested movies:
    const fallbackPosters = [
      // Inception replaced with Joker
      {title: 'Joker', poster_path: 'https://image.tmdb.org/t/p/w500/udDclJoHjfjb8Ekgsd4FDteOkCU.jpg'},

      {title: 'Interstellar', poster_path: 'https://image.tmdb.org/t/p/w500/rAiYTfKGqDCRIIqo664sY9XZIvQ.jpg'},
      {title: 'The Dark Knight', poster_path: 'https://image.tmdb.org/t/p/w500/qJ2tW6WMUDux911r6m7haRef0WH.jpg'},
      {title: 'Avengers: Endgame', poster_path: 'https://image.tmdb.org/t/p/w500/or06FN3Dka5tukK1e9sl16pB3iy.jpg'},
      {title: 'The Matrix', poster_path: 'https://image.tmdb.org/t/p/w500/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg'},
      {title: 'Pulp Fiction', poster_path: 'https://image.tmdb.org/t/p/w500/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg'},
      {title: 'Fight Club', poster_path: 'https://image.tmdb.org/t/p/w500/bptfVGEQuv6vDTIMVCHjJ9Dz8PX.jpg'},
      {title: 'Forrest Gump', poster_path: 'https://image.tmdb.org/t/p/w500/saHP97rTPS5eLmrLQEcANmKrsFl.jpg'},
      {title: 'The Shawshank Redemption', poster_path: 'https://image.tmdb.org/t/p/w500/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg'},
      {title: 'Gladiator', poster_path: 'https://image.tmdb.org/t/p/w500/ty8TGRuvJLPUmAR1H1nRIsgwvim.jpg'},
      {title: 'The Lion King', poster_path: 'https://image.tmdb.org/t/p/w500/sKCr78MXSLixwmZ8DyJLrpMsd15.jpg'},

      // Jurassic Park replaced with The Batman
      {title: 'The Batman', poster_path: 'https://image.tmdb.org/t/p/w500/74xTEgt7R36Fpooo50r9T25onhq.jpg'},

      {title: 'Toy Story', poster_path: 'https://image.tmdb.org/t/p/w500/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg'},
      {title: 'Spider-Man: Into the Spider-Verse', poster_path: 'https://image.tmdb.org/t/p/w500/iiZZdoQBEYBv6id8su7ImL0oCbD.jpg'},

      // Frozen replaced with Dune
      {title: 'Dune', poster_path: 'https://image.tmdb.org/t/p/w500/d5NXSklXo0qyIYkgV94XAgMIckC.jpg'},

      {title: 'Black Panther', poster_path: 'https://image.tmdb.org/t/p/w500/uxzzxijgPIY7slzFvMotPv8wjKA.jpg'},
      {title: 'Wonder Woman', poster_path: 'https://image.tmdb.org/t/p/w500/8UlWHLMpgZm9bx6QYh0NFoq67TZ.jpg'},

      // Guardians of the Galaxy replaced with Star Wars: The Rise of Skywalker
      {title: 'Star Wars: The Rise of Skywalker', poster_path: 'https://image.tmdb.org/t/p/w500/db32LaOibwEliAmSL2jjDF6oDdj.jpg'},

      // Deadpool replaced with Spider-Man: No Way Home
      {title: 'Spider-Man: No Way Home', poster_path: 'https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg'},

      {title: 'The Avengers', poster_path: 'https://image.tmdb.org/t/p/w500/RYMX2wcKCBAr24UyPD7xwmjaTn.jpg'}
    ];

    function displayPosters(movies) {
      posterGrid.innerHTML = '';
      movies.forEach(movie => {
        if(movie.poster_path){
          const div = document.createElement('div');
          div.className = 'col-md-3 poster-item';
          div.innerHTML = `
            <img src="${movie.poster_path.startsWith('http') ? movie.poster_path : 'https://image.tmdb.org/t/p/w500'+movie.poster_path}" alt="${movie.title}" />
            <p class="text-center mt-2">${movie.title}</p>
          `;
          posterGrid.appendChild(div);
        }
      });
    }

    // Fetch posters from TMDB API if key exists, else fallback
    if(apiKey && apiKey !== 'YOUR_TMDB_API_KEY'){
      fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&language=en-US&page=1`)
        .then(res => {
          if(!res.ok) throw new Error('API fetch failed');
          return res.json();
        })
        .then(data => {
          if(data.results && data.results.length > 0){
            displayPosters(data.results.slice(0,20));
          } else {
            displayPosters(fallbackPosters);
          }
        })
        .catch(() => displayPosters(fallbackPosters));
    } else {
      displayPosters(fallbackPosters);
    }

    // 1. Data table CRUD with save and chart update
    const genreLabels = ['Action', 'Adventure', 'Comedy', 'Romance', 'Horror', 'Animation'];
    const defaultTotals = [5, 4, 6, 3, 1, 2];

    function loadGenreTotals(){
      const stored = localStorage.getItem('genreTotals');
      if(stored){
        try {
          const parsed = JSON.parse(stored);
          if(Array.isArray(parsed) && parsed.length === genreLabels.length){
            return parsed;
          }
        } catch {}
      }
      return defaultTotals;
    }

    function saveGenreTotals(totals){
      localStorage.setItem('genreTotals', JSON.stringify(totals));
    }

    function buildGenreTable(totals){
      const tbody = document.getElementById('genre-table');
      tbody.innerHTML = '';
      for(let i=0; i<genreLabels.length; i++){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${genreLabels[i]}</td>
          <td contenteditable="true" data-genre="${genreLabels[i]}" class="total-cell">${totals[i]}</td>
          <td><button class="btn btn-sm btn-danger" data-index="${i}">Delete</button></td>
        `;
        tbody.appendChild(tr);
      }
    }

    let genreTotals = loadGenreTotals();
    buildGenreTable(genreTotals);

    const genreChartCtx = document.getElementById('genreChart').getContext('2d');
    let genreChart = new Chart(genreChartCtx, {
      type: 'doughnut',
      data: {
        labels: genreLabels,
        datasets: [{
          data: genreTotals,
          backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#20c997', '#0d6efd', '#6f42c1']
        }]
      },
      options: {responsive:true, plugins:{legend:{position:'bottom'}}}
    });

    function updateTotalsAndChart(){
      const totals = [];
      const cells = document.querySelectorAll('.total-cell');
      cells.forEach(cell => {
        let val = parseInt(cell.textContent);
        if(isNaN(val) || val < 0) val = 0;
        totals.push(val);
        cell.textContent = val;
      });
      genreTotals = totals;
      saveGenreTotals(totals);
      genreChart.data.datasets[0].data = totals;
      genreChart.update();
    }

    // Delete row and update
    document.getElementById('genre-table').addEventListener('click', e => {
      if(e.target.tagName === 'BUTTON'){
        const idx = parseInt(e.target.dataset.index);
        if(!isNaN(idx)){
          genreLabels.splice(idx,1);
          genreTotals.splice(idx,1);
          saveGenreTotals(genreTotals);
          buildGenreTable(genreTotals);
          updateTotalsAndChart();
        }
      }
    });

    // Listen to blur event to save updated total immediately when user finishes editing a cell
document.getElementById('genre-table').addEventListener('blur', e => {
  if (e.target.classList.contains('total-cell')) {
    const genre = e.target.dataset.genre;
    let val = parseInt(e.target.textContent);
    if (isNaN(val) || val < 0) val = 0;
    e.target.textContent = val;

    // Update the correct index in genreTotals
    const index = genreLabels.indexOf(genre);
    if (index !== -1) {
      genreTotals[index] = val;
      saveGenreTotals(genreTotals);
      genreChart.data.datasets[0].data = genreTotals;
      genreChart.update();
    }
  }
}, true); // useCapture=true to catch blur during event capturing

    // 2. Rental Price Calculator with saving and display below
    function calculatePrice(){
      const name = document.getElementById('username').value.trim();
      const totalMovies = parseInt(document.getElementById('rentedMovies').value);
      const pricePerMovie = parseFloat(document.getElementById('pricePerMovie').value);
      const result = document.getElementById('result');

      if(!name){
        result.textContent = 'Please enter your name.';
        return;
      }
      if(isNaN(totalMovies) || totalMovies < 0){
        result.textContent = 'Please enter a valid number of movies rented.';
        return;
      }
      if(isNaN(pricePerMovie) || pricePerMovie < 0){
        result.textContent = 'Please enter a valid price per movie.';
        return;
      }
      const totalPrice = totalMovies * pricePerMovie;
      result.textContent = `${name}, your total rental price is $${totalPrice.toFixed(2)}`;

      saveRentalRecord({name, totalMovies, pricePerMovie, totalPrice});
      renderRentalRecords();
    }

    function saveRentalRecord(record){
      let records = JSON.parse(localStorage.getItem('rentalRecords') || '[]');
      records.push(record);
      localStorage.setItem('rentalRecords', JSON.stringify(records));
    }

    function renderRentalRecords(){
      const tbody = document.getElementById('rental-records-body');
      let records = JSON.parse(localStorage.getItem('rentalRecords') || '[]');
      tbody.innerHTML = '';
      if(records.length === 0){
        tbody.innerHTML = `<tr><td colspan="4" class="text-center">No rental records found.</td></tr>`;
        return;
      }
      records.forEach(rec => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${rec.name}</td>
          <td>${rec.totalMovies}</td>
          <td>$${rec.pricePerMovie.toFixed(2)}</td>
          <td>$${rec.totalPrice.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function clearRentalRecords(){
      if(confirm('Are you sure you want to clear all rental records?')){
        localStorage.removeItem('rentalRecords');
        renderRentalRecords();
      }
    }

    renderRentalRecords();
  </script>
</body>
</html>

 /*
    ============================
    🎬 Movie Rental Dashboard - JavaScript Overview
    ============================

    🚀 1. Bootstrap Integration:
       - Bootstrap 5 is used for responsive layout, styling, and UI components like buttons, tables, and grid.
       - Classes like `container`, `row`, `col-md-*`, `btn`, and `table` help build a mobile-friendly dashboard.

    🌐 2. TMDB API (optional):
       - Poster images are fetched using The Movie Database (TMDB) API.
       - If an API key is not provided, fallback movie posters are used instead.
       - Demonstrates how to handle external data with `fetch()` and handle JSON responses.

    🧠 3. DOM Manipulation:
       - JavaScript dynamically creates and updates HTML elements like tables, images, and chart data.
       - Methods like `document.createElement`, `appendChild`, `querySelector`, and `innerHTML` are used.
       - Live updates happen on user input (e.g., updating totals or rental records).

    ✏️ 4. CRUD Operations (on Genre and Rental Records):
       - Create: Add movie rental records and genre totals.
       - Read: Load records from `localStorage` on page load.
       - Update: Edit totals directly in the data table or update rental records.
       - Delete: Clear all saved rental records or remove a genre row.

    📊 5. Chart.js Doughnut Chart:
       - Visualizes genre totals using a doughnut chart from Chart.js.
       - Auto-updates whenever the data table is edited.

    📋 6. Data Table:
       - A genre table displays editable movie totals per genre.
       - Another table shows saved rental transactions, fetched from `localStorage`.

    📁 7. Dashboard Functionality:
       - A user-friendly dashboard combining visual stats (chart), editable data (table), and interactions (form).
       - Rental calculator computes total cost per user and displays/saves the result.

    👨‍💻 Summary:
       This file showcases a full front-end dashboard app using HTML, CSS (Bootstrap), JavaScript (DOM/API/CRUD),
       and a real chart library (Chart.js) with persistent data storage using `localStorage`. */