<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Rental Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .poster-item img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 5px;
    }
    .poster-item {
      margin-bottom: 20px;
    }
    .genre-card {
      color: white;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    #rentalRecordsTable td, #rentalRecordsTable th {
      vertical-align: middle;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">Movie Rental Dashboard</h1>

    <!-- Genre Cards -->
    <div class="row mb-4 g-3 text-white">
      <div class="col-md-2 genre-card" style="background-color:#dc3545;">Action</div>
      <div class="col-md-2 genre-card" style="background-color:#fd7e14;">Adventure</div>
      <div class="col-md-2 genre-card" style="background-color:#ffc107; color:#212529;">Comedy</div>
      <div class="col-md-2 genre-card" style="background-color:#20c997;">Romance</div>
      <div class="col-md-2 genre-card" style="background-color:#0d6efd;">Horror</div>
      <div class="col-md-2 genre-card" style="background-color:#6f42c1;">Animation</div>
    </div>

    <!-- Movie Posters Grid -->
    <div class="row" id="movie-posters"></div>

    <!-- Table & Doughnut Chart Section -->
    <div class="row mt-5">
      <div class="col-md-8">
        <table class="table table-bordered text-center align-middle">
          <thead class="table-dark">
            <tr><th>Genre</th><th>Total</th><th>Action</th></tr>
          </thead>
          <tbody id="genre-table"></tbody>
        </table>
      </div>
      <div class="col-md-4">
        <canvas id="genreChart"></canvas>
      </div>
    </div>


    <div class="mt-5">
      <h4>Calculate Rental Cost</h4>
      <input type="text" id="username" placeholder="Enter your name" class="form-control mb-2" />
      <input type="number" id="rentedMovies" placeholder="Movies rented today" class="form-control mb-2" />
      <input type="number" id="pricePerMovie" placeholder="Price per movie" value="5" class="form-control mb-2" />
      <button class="btn btn-primary" onclick="calculatePrice()">Calculate</button>
      <p id="result" class="mt-3 fw-bold"></p>
    </div>

    <div class="mt-4">
      <h5>Saved Rental Records</h5>
      <table class="table table-striped" id="rentalRecordsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Movies Rented</th>
            <th>Price per Movie</th>
            <th>Total Price</th>
          </tr>
        </thead>
        <tbody id="rental-records-body"></tbody>
      </table>
      <button class="btn btn-danger" onclick="clearRentalRecords()">Clear All Records</button>
    </div>
  </div>

  <script>
    const posterGrid = document.getElementById('movie-posters');

    // List of IMDb IDs you want to fetch
    const imdbIDs = [
      "tt2250912", // Spider-Man: Homecoming
      "tt1375666", // Inception
      "tt0816692", // Interstellar
      "tt4154796", // Avengers: Endgame
      "tt0133093", // The Matrix
      "tt0110912", // Pulp Fiction
    ];

    async function fetchMultipleMovies(ids) {
      const movies = [];
      for (const id of ids) {
        try {
          const res = await fetch(`https://imdb.iamidiotareyoutoo.com/search?tt=${id}`);
          const data = await res.json();
          if (data.ok && data.short) {
            movies.push({
              title: data.short.name,
              poster_path: data.short.image
            });
          }
        } catch (err) {
          console.error(`Failed to fetch movie ${id}`, err);
        }
      }
      displayPosters(movies);
    }

    
    function displayPosters(movies) {
      posterGrid.innerHTML = '';
      movies.forEach(movie => {
        if(movie.poster_path && movie.title){
          const div = document.createElement('div');
          div.className = 'col-md-3 poster-item';
          div.innerHTML = `
            <img src="${movie.poster_path}" alt="${movie.title}" />
            <p class="text-center mt-2">${movie.title}</p>
          `;
          posterGrid.appendChild(div);
        }
      });
    }

    fetchMultipleMovies(imdbIDs);

    // Genre & Rental code below unchanged from your original (you can keep it as is)

    const genreLabels = ['Action', 'Adventure', 'Comedy', 'Romance', 'Horror', 'Animation'];
    const defaultTotals = [5, 4, 6, 3, 1, 2];

    function loadGenreTotals(){
      const stored = localStorage.getItem('genreTotals');
      if(stored){
        try {
          const parsed = JSON.parse(stored);
          if(Array.isArray(parsed) && parsed.length === genreLabels.length){
            return parsed;
          }
        } catch {}
      }
      return defaultTotals;
    }

    function saveGenreTotals(totals){
      localStorage.setItem('genreTotals', JSON.stringify(totals));
    }

    function buildGenreTable(totals){
      const tbody = document.getElementById('genre-table');
      tbody.innerHTML = '';
      for(let i=0; i<genreLabels.length; i++){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${genreLabels[i]}</td>
          <td contenteditable="true" data-genre="${genreLabels[i]}" class="total-cell">${totals[i]}</td>
          <td><button class="btn btn-sm btn-danger" data-index="${i}">Delete</button></td>
        `;
        tbody.appendChild(tr);
      }
    }

    let genreTotals = loadGenreTotals();
    buildGenreTable(genreTotals);

    const genreChartCtx = document.getElementById('genreChart').getContext('2d');
    let genreChart = new Chart(genreChartCtx, {
      type: 'doughnut',
      data: {
        labels: genreLabels,
        datasets: [{
          data: genreTotals,
          backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#20c997', '#0d6efd', '#6f42c1']
        }]
      },
      options: {responsive:true, plugins:{legend:{position:'bottom'}}}
    });

    function updateTotalsAndChart(){
      const totals = [];
      const cells = document.querySelectorAll('.total-cell');
      cells.forEach(cell => {
        let val = parseInt(cell.textContent);
        if(isNaN(val) || val < 0) val = 0;
        totals.push(val);
        cell.textContent = val;
      });
      genreTotals = totals;
      saveGenreTotals(totals);
      genreChart.data.datasets[0].data = totals;
      genreChart.update();
    }

    document.getElementById('genre-table').addEventListener('click', e => {
      if(e.target.tagName === 'BUTTON'){
        const idx = parseInt(e.target.dataset.index);
        if(!isNaN(idx)){
          genreLabels.splice(idx,1);
          genreTotals.splice(idx,1);
          saveGenreTotals(genreTotals);
          buildGenreTable(genreTotals);
          updateTotalsAndChart();
        }
      }
    });

    document.getElementById('genre-table').addEventListener('blur', e => {
      if (e.target.classList.contains('total-cell')) {
        const genre = e.target.dataset.genre;
        let val = parseInt(e.target.textContent);
        if (isNaN(val) || val < 0) val = 0;
        e.target.textContent = val;

        const index = genreLabels.indexOf(genre);
        if (index !== -1) {
          genreTotals[index] = val;
          saveGenreTotals(genreTotals);
          genreChart.data.datasets[0].data = genreTotals;
          genreChart.update();
        }
      }
    }, true);

    function calculatePrice(){
      const name = document.getElementById('username').value.trim();
      const totalMovies = parseInt(document.getElementById('rentedMovies').value);
      const pricePerMovie = parseFloat(document.getElementById('pricePerMovie').value);
      const result = document.getElementById('result');

      if(!name){
        result.textContent = 'Please enter your name.';
        return;
      }
      if(isNaN(totalMovies) || totalMovies < 0){
        result.textContent = 'Please enter a valid number of movies rented.';
        return;
      }
      if(isNaN(pricePerMovie) || pricePerMovie < 0){
        result.textContent = 'Please enter a valid price per movie.';
        return;
      }
      const totalPrice = totalMovies * pricePerMovie;
      result.textContent = `${name}, your total rental price is $${totalPrice.toFixed(2)}`;

      saveRentalRecord({name, totalMovies, pricePerMovie, totalPrice});
      renderRentalRecords();
    }

    function saveRentalRecord(record){
      let records = JSON.parse(localStorage.getItem('rentalRecords') || '[]');
      records.push(record);
      localStorage.setItem('rentalRecords', JSON.stringify(records));
    }

    function renderRentalRecords(){
      const tbody = document.getElementById('rental-records-body');
      let records = JSON.parse(localStorage.getItem('rentalRecords') || '[]');
      tbody.innerHTML = '';
      if(records.length === 0){
        tbody.innerHTML = `<tr><td colspan="4" class="text-center">No rental records found.</td></tr>`;
        return;
      }
      records.forEach(rec => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${rec.name}</td>
          <td>${rec.totalMovies}</td>
          <td>$${rec.pricePerMovie.toFixed(2)}</td>
          <td>$${rec.totalPrice.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function clearRentalRecords(){
      if(confirm('Are you sure you want to clear all rental records?')){
        localStorage.removeItem('rentalRecords');
        renderRentalRecords();
      }
    }

    renderRentalRecords();
  </script>
</body>
</html>

